<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ request.app.title }} - Canal {{ channel.channel_number }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body { padding: 20px; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    .small-muted { color: #666; font-size: .9rem; }
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <a href="/" class="small-muted">&larr; voltar</a>
      <h2 class="mb-1">{{ channel.channel_number }} - {{ channel.name }}</h2>
      <div class="small-muted">
        Provider: <code>{{ channel.provider_id }}</code> ({{ channel.provider_name }}) |
        Categoria: <code>{{ channel.category }}</code> |
        Tipo: <code>{{ channel.kind }}</code>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header"><b>Playlists do Canal</b></div>
    <div class="card-body">
      <form class="row g-2" method="post" action="/admin/playlists/create">
        <input type="hidden" name="channel_id" value="{{ channel.id }}">
        <input type="hidden" name="return_channel_id" value="{{ channel.id }}">
        <div class="col-md-4">
          <label class="form-label mb-1">Nome</label>
          <input class="form-control" name="name" placeholder="playlist_noite" required>
        </div>
        <div class="col-md-6">
          <label class="form-label mb-1">Descricao</label>
          <input class="form-control" name="description" placeholder="Opcional">
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-primary btn-sm w-100">Criar</button>
        </div>
      </form>

      <hr>
      <table class="table table-sm align-middle">
        <thead><tr><th>ID</th><th>Nome</th><th>Descricao</th><th></th></tr></thead>
        <tbody>
          {% for pl in playlists %}
            <tr>
              <td><code>{{ pl.id }}</code></td>
              <td><b>{{ pl.name }}</b></td>
              <td>{{ pl.description or "" }}</td>
              <td class="text-end">
                <form method="post" action="/admin/playlists/delete" onsubmit="return confirm('Excluir playlist {{pl.name}}?');">
                  <input type="hidden" name="id" value="{{pl.id}}">
                  <input type="hidden" name="return_channel_id" value="{{ channel.id }}">
                  <button class="btn btn-outline-danger btn-sm">Excluir</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><b>Conteudo (URLs) do Canal</b></div>
    <div class="card-body">
      <form class="row g-2" method="post" action="/admin/channel-items/create">
        <input type="hidden" name="channel_id" value="{{ channel.id }}">
        <input type="hidden" name="return_channel_id" value="{{ channel.id }}">
        <div class="col-md-5">
          <label class="form-label mb-1">Playlist</label>
          <select class="form-select" name="playlist_id" required>
            {% for pl in playlists %}
              <option value="{{pl.id}}">{{ pl.name }} (#{{ pl.id }})</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label mb-1">Posicao</label>
          <input class="form-control" name="position" type="number" value="1" required>
        </div>
        <div class="col-md-2">
          <label class="form-label mb-1">Tipo</label>
          <select class="form-select" name="type">
            <option value="video">video</option>
            <option value="ad">ad</option>
          </select>
        </div>
        <div class="col-md-12">
          <label class="form-label mb-1">URL (somente para video)</label>
          <input class="form-control" name="url" placeholder="https://youtube.com/...">
        </div>
        <div class="col-12 d-flex gap-2 align-items-center">
          <button class="btn btn-primary btn-sm">Adicionar URL</button>
          <span class="small-muted">Duracao e automatica (ad=30s, video via metadata/fallback).</span>
        </div>
      </form>

      <hr>
      <table class="table table-sm align-middle">
        <thead><tr><th>Playlist</th><th>Pos</th><th>Tipo</th><th>Duracao</th><th>URL</th><th></th></tr></thead>
        <tbody>
          {% for it in playlist_items %}
            <tr>
              <td><code>{{ it.playlist_name }}</code></td>
              <td><code>{{ it.position }}</code></td>
              <td><code>{{ it.type }}</code></td>
              <td><code>{{ it.duration }}</code></td>
              <td style="max-width: 420px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap;"><code>{{ it.url or '' }}</code></td>
              <td class="text-end">
                <form method="post" action="/admin/channel-items/delete" onsubmit="return confirm('Excluir item {{it.id}}?');">
                  <input type="hidden" name="id" value="{{it.id}}">
                  <input type="hidden" name="return_channel_id" value="{{ channel.id }}">
                  <button class="btn btn-outline-danger btn-sm">Excluir</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
</html>
